# ðŸš€ QUICK START: Using Custom Tokens with Your Vault

## The Problem You're Experiencing

When you try to deposit a custom token (like AQX) or deposit XLM into an AQX vault, you see:
```
"No liquidity pool found between your deposit token and AQX"
```

**Why?** The vault doesn't know about your custom liquidity pools yet!

## âœ… Solution: Register Your Custom Pools

### Step 1: Make Sure Vault is Initialized
Your vault must be initialized first. Check the frontend or run:
```powershell
stellar contract invoke --id YOUR_VAULT_ADDRESS --network testnet -- get_state
```

### Step 2: Register Custom Pools
Run this simple command:

```powershell
.\quick-register-pools.ps1 -VaultAddress "YOUR_VAULT_ADDRESS"
```

Or if you have `VAULT_ADDRESS` environment variable set:
```powershell
.\quick-register-pools.ps1
```

This will register all 10 custom token pools (AQX, VLTK, SLX, etc.)

### Step 3: Try Your Deposit Again
Now when you deposit:
- **XLM â†’ AQX vault**: Vault finds AQX custom pool âœ“
- **AQX â†’ XLM vault**: Vault finds AQX custom pool âœ“
- **VLTK â†’ any vault**: Vault finds VLTK custom pool âœ“

## ðŸ” How to Verify It's Working

After registering pools, when you deposit, check the contract logs:
- âœ“ Should see: `"Found custom pool: CDNN..."`
- âœ“ Should see: `"Custom pool swap: ... -> ..."`
- âœ— Should NOT see: `"No custom pool found, trying Soroswap..."`

## ðŸ“‹ What Gets Registered

The script registers these token-pool mappings in the vault's storage:

| Token | Symbol | Pool Address |
|-------|--------|--------------|
| CAAB... | AQX | CDNN... |
| CBBB... | VLTK | CDV2... |
| CCU7... | SLX | CC47... |
| ... | ... | ... |

## ðŸŽ¯ Complete Flow Example

### Example: Deposit XLM into AQX Vault

**Before Registration:**
1. User deposits XLM
2. Vault needs to swap XLM â†’ AQX
3. âŒ No custom pool registered
4. âŒ Tries Soroswap (no pool exists)
5. âŒ Error: "No liquidity pool found"

**After Registration:**
1. User deposits XLM
2. Vault needs to swap XLM â†’ AQX
3. âœ… Finds registered custom pool for AQX
4. âœ… Swaps XLM â†’ AQX via custom pool
5. âœ… Mints vault shares

## ðŸ”§ Troubleshooting

### Error: "Vault not initialized"
**Solution:** Initialize your vault first via the frontend

### Error: "Unauthorized"
**Solution:** Make sure you're using the correct deployer/owner key

### Pools registered but still getting "No pool found"
**Solution:** 
1. Redeploy the vault contract with the updated code
2. Re-register the pools
3. Make sure you're using the NEW vault address

### Want to check if pools are registered?
Unfortunately there's no direct query function yet, but you can:
1. Try a deposit and check the logs
2. Look for "Found custom pool" messages

## ðŸ“ Technical Details

The registration stores this in the vault's contract storage:
```rust
Storage Key: (CUSTOM_POOL, token_address) -> pool_address
Example: (CUSTOM_POOL, AQX_ADDRESS) -> AQX_POOL_ADDRESS
```

When swapping, the vault:
1. Checks: Does either token have a registered custom pool?
2. If YES: Use custom pool âœ“
3. If NO: Try Soroswap (may fail) âœ—

## ðŸŽ‰ Next Steps After Registration

Once pools are registered, you can:
- âœ… Deposit any custom token (AQX, VLTK, SLX, etc.)
- âœ… Create vaults with custom tokens as base assets
- âœ… Mix custom tokens and standard tokens (XLM, USDC)
- âœ… Automatic routing through custom pools

## ðŸ’¡ Pro Tips

1. **Deploy new vault if needed**: If you're still having issues, deploy a fresh vault with the updated contract code
2. **Check logs**: Enable contract logging to see "Found custom pool" messages
3. **Test with small amounts**: Try 1 XLM first before larger deposits
4. **One-time setup**: You only need to register pools once per vault

---

**TL;DR**: Run `.\quick-register-pools.ps1 -VaultAddress YOUR_VAULT` and your custom token swaps will work! ðŸš€
